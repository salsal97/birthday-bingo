<!--
    There's no place like ~

    Authors: Saloni Goel & Abhinav Nair, 2020
    Previous Author: Werner Stoop, 2012
-->
<html>

<head>
    <!-- browser icon -->
    <script src="https://kit.fontawesome.com/39896120a5.js" crossorigin="anonymous"></script>

    <!-- fonts -->
    <link href='https://fonts.googleapis.com/css?family=Playfair+Display' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=DM+Mono' rel='stylesheet'>

    <!-- css -->
    <link rel="stylesheet" type="text/css" href="bingo.css">
    <script src="songs.txt"></script>

    <!-- Disable right click http://www.spacegun.co.uk -->
    <script language=JavaScript>
        var message = "Try not to cheat, sucker.";

        function rtclickcheck(keyp) {
            if (navigator.appName == "Netscape" && keyp.which == 3) {
                alert(message);
                return false;
            }
            if (navigator.appVersion.indexOf("MSIE") != -1 && event.button == 2) {
                alert(message);
                return false;
            }
        }
        document.onmousedown = rtclickcheck;
    </script>

    <title>Song Bingo</title>

    <script type="text/javascript">
        var N = N1;
        var data = data1;
        var wrong_guess_threshold = wrong_guess_threshold1;
        var wrong_guesses = new Array(N * N).fill(0);
        var correct_guesses = 0;
        var youTubeUrl = "https://www.youtube.com/embed/MjvFqxuatRc";



        // generate/restart game
        function generate() {
            var node = document.getElementById("grid");

            if (node.innerHTML && !confirm("Are you sure you want to regenerate?"))
                return;

            var html = '<table border="0">';
            for (var y = 0; y < N; y++) {
                html += "<tr>"
                for (var x = 0; x < N; x++) {
                    var obj = data[x + y * N];
                    // create a table object
                    html += '<td id="cell_' + x + '_' + y + '" >' +
                        '<span id="chk-cell_' + x + '_' + y + '" onclick="cellClicked(\'cell_' + x + '_' + y + "')\"> <i class=\"fas fa-dice\"></i></span>" +
                        "\t" + obj.song + " - " + obj.artist +
                        "<br>" + '<span onClick="openPlayer('+x+')"><i class="fab fa-youtube"></i></span>' + "\t" + obj.quote + "</td>";
                }
                html += "</tr>"
            }
            html += "</table>";
            node.innerHTML = html;
            save("bingo.grid", html);
            saveGameState();
        }

        /* http://diveintohtml5.info/storage.html */
        function supports_html5_storage() {
            try {
                return 'localStorage' in window && window['localStorage'] !== null;
            } catch (e) {
                return false;
            }
        }

        
        function cellClicked(id) {
            var c = document.getElementById("chk-" + id);
            var d = document.getElementById(id);
            var leaderboard = document.getElementById("leaderboard");
            var temp = id.split("_");
            var i = Number(temp[1]) + Number(temp[2]) * N;

            var person = prompt("Enter the name of the friend " + data[i].friend).toLowerCase();
            if (person != null) {
                if (person == data[i].friend) {
                    d.innerHTML = data[i].friend.toUpperCase();
                    d.style.backgroundColor = "#114C80";
                    leaderboard.innerHTML += data[i].friend + ", ";
                    correct_guesses++;

                    if (correct_guesses == 1) {
                        document.getElementById("grid").innerHTML = '<h1 style="background:#0A7328"> Congratulations! Your prize is loading ...</h1>';
                        document.getElementById("leaderboard").innerHTML = '<h1 style="background:white"> </h1>';

                        var elem = document.getElementById("leaderboard");
                        var width = 1;
                        var id = setInterval(frame, 100);

                        function frame() {
                            if (width >= 100) {
                                clearInterval(id);
                                window.location.replace("prize.html");
                            } else {
                                width++;
                                elem.style.width = width + '%';
                            }
                        }
                    }
                } else {
                    wrong_guesses[i]++;
                    if (wrong_guesses[i] >= wrong_guess_threshold) {
                        if (confirm("Cheat code activated. Would you like to know the answer?"))
                            alert("The correct answer is " + data[i].friend);
                    }
                    d.style.backgroundColor = "#E69D29";
                    if (!d.innerHTML.endsWith(", ")) {
                        d.innerHTML += "<br> Wrong guess: ";
                    }
                    d.innerHTML += person + ", ";
                }
            }
            saveGameState();
        }


        //open YouTube embedded
        function openPlayer(id) {
            var youTubeCode = data[id].link;
            console.log(youTubeCode);
            var elem = document.getElementById("embeddedPlayer");
            document.getElementById("youtubePlayer").src = "https://www.youtube.com/embed/"+youTubeCode;
            if (elem.style.display == "block")
                elem.style.display = "none";
            else
                elem.style.display = "block";
        }


        function saveGameState() {
            for (var y = 0; y < N; y++) {
                for (var x = 0; x < N; x++) {
                    var id = 'cell_' + x + '_' + y;
                    var c = document.getElementById("chk-" + id);
                    if (id1.localeCompare(id) != 0)
                        save("bingo." + id1 + "--------" + id, c.checked);
                    else
                        save("bingo." + id + "_" + person, c.checked);
                }
            }
        }

        function loadGameState() {
            for (var y = 0; y < N; y++) {
                for (var x = 0; x < N; x++) {
                    var id = 'cell_' + x + '_' + y;
                    var c = document.getElementById("chk-" + id);
                    c.checked = (load("bingo." + id) == 'true');
                    var d = document.getElementById(id);
                    d.className = (c.checked) ? "highlight" : "";
                }
            }
        }

        function toggle(id) {
            var elem = document.getElementById(id);
            if (elem.style.display == "block")
                elem.style.display = "none";
            else
                elem.style.display = "block";
        }

        save = function (key, value) { };
        load = function (key) {
            return null
        };

        function start() {
            if (supports_html5_storage()) {
                save = function (key, value) {
                    localStorage.setItem(key, value);
                };
                load = function (key) {
                    return localStorage.getItem(key);
                };
            } else {
                alert("Your browser does not support localStorage.\nYou won't be able to persist the Bingo grid.\nUpgrading your browser may help.");
                return;
            }

            var grid = load("bingo.grid");
            if (grid) {
                console.log("Loaded a previously generated grid");
                var node = document.getElementById("grid");
                node.innerHTML = grid;
                loadGameState();
            }
        }
    </script>
</head>

<body onLoad="start()">
    <h1>Song Bingo</h1>

    <p>An exciting game for your quarantine birthday!<a href="javascript:toggle('instructions');"> Instructions...</a>
    </p>

    <noscript>
        <div class="error">
            <strong>Problem:</strong>
            <p><em>
                    You do not have JavaScript enabled. JavaScript must be enabled for this application to work.
                </em></p>
        </div>
    </noscript>

    <div id="instructions">
        <h2>Instructions</h2>
        <ol>
            <noscript>
                <li>Enable JavaScript</li>
            </noscript>
            <li>Click <strong>Refresh</strong> to create your Bingo board.</li>
            <li>In the boxes you see the name of a song, its artist, and a quote from the song that someone chose for
                you </li>
            <li>Click on the <i class="fab fa-youtube"></i> in the box to play the song </li>
            <li><strong>Click on the <i class="fas fa-dice"></i> in the box to guess who chose this song! </strong></li>
            <li>If your guess is right, the box will change color and display the name of the person (: </li>
            <li>If your guess is wrong, the box will show you your incorrect guess to help you narrow your search </li>
            <li>HINT: The main page of this website should be populated with the people who participated! We restricted
                this to first names to make it easy </li>
        </ol>
    </div>

    <div id="embeddedPlayer">
        <iframe id="youtubePlayer" width="560" height="315" 
            frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen></iframe>;
    </div>

    <form>
        <input type="button" value="Refresh" onClick="generate();" />
    </form>

    <div id="grid"></div>
    <div id="leaderboard">
        <h2>Correct guesses</h2>
    </div>
</body>

</html>